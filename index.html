<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Striks AI - Habit Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Striks AI Merkkleurenpalet */
            --primary-color: #1A2B50; /* Striks Marineblauw */
            --secondary-color: #3BC5C9; /* AI Turquoise */
            --accent-color: #C64B8C; /* Menselijk Magenta */
            --hardline-color: #F27052; /* Zonsopgang Oranje */
            --mainline-color: #4B99D2; /* Oceaan Blauw */
            --softline-color: #8A4E85; /* Diep Paars */
            --bg-color: #F7F9FC; /* Lichtgrijs */
            --card-bg: #FFFFFF;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --highlight-color: #F9B854; /* Gouden Inzicht */
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .btn {
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-1px);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .habit-btn {
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .habit-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }
        
        .habit-btn:active::after {
            width: 200px;
            height: 200px;
        }
        
        .habit-cell {
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .habit-cell:hover {
            transform: scale(1.05);
        }
        
        .habit-cell.completed {
            position: relative;
        }
        
        .habit-cell.completed::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
        }
        
        .progress-ring {
            transition: stroke-dashoffset 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        .streak-badge {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 12px;
            padding: 4px 12px;
            font-weight: bold;
        }
        
        .hardline { background-color: var(--hardline-color); }
        .mainline { background-color: var(--mainline-color); }
        .softline { background-color: var(--softline-color); }
        
        .streak-container {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 16px;
        }
        
        .category-header {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }
        
        .category-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            100% { left: 100%; }
        }
        
        .habit-name-input {
            background-color: transparent;
            border: none;
            border-bottom: 1px solid #ddd;
            transition: border-color 0.3s ease;
            width: 100%;
            outline: none;
            padding: 4px 0;
        }
        
        .habit-name-input:focus {
            border-bottom: 2px solid var(--primary-color);
        }
        
        /* Make sure content is optimized for PDF export */
        @page {
            size: auto;
            margin: 0mm;
        }
        
        html {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
        
        .logout-btn {
            background-color: transparent;
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .user-welcome {
            display: flex;
            align-items: center;
            margin-right: 12px;
            color: white;
            font-weight: 500;
        }
        
        .user-icon {
            background-color: rgba(255, 255, 255, 0.2);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }
        
        /* Branding elementen */
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo {
            height: 50px;
            margin-right: 15px;
        }
        
        .tagline {
            font-weight: 300;
            color: var(--text-secondary);
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }
        
        /* CTA knoppen in Striks stijl */
        .striks-btn {
            background: linear-gradient(135deg, var(--accent-color), var(--highlight-color));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .striks-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.1);
        }
        
        /* Responsive styling voor mobiele apparaten */
        @media (max-width: 768px) {
            .grid-cols-8 {
                grid-template-columns: 1fr repeat(7, minmax(30px, 1fr));
            }
            
            .habit-cell {
                height: 36px !important;
                width: 36px;
            }
            
            .habit-name-input {
                max-width: 100%;
                font-size: 14px;
                padding: 8px 4px;
            }
            
            header {
                flex-direction: column;
            }
            
            header .flex {
                flex-direction: column;
                align-items: center;
            }
            
            header h1 {
                margin-bottom: 10px;
                text-align: center;
            }
            
            .streak-container {
                width: 100%;
                margin-top: 10px;
            }
            
            .add-habit-btn {
                width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 10px;
            }
            
            .logo {
                height: 40px;
                margin-bottom: 10px;
            }
        }
        
        /* Extra kleine schermen (mobiele telefoons) */
        @media (max-width: 480px) {
            body {
                font-size: 16px;
            }
            
            .card {
                padding: 12px !important;
                margin-bottom: 16px;
            }
            
            .grid-cols-8 {
                grid-template-columns: 5fr repeat(7, minmax(28px, 1fr)) !important;
            }
            
            .habit-cell {
                height: 36px !important;
                width: 36px !important;
                margin: 1px;
                display: flex;
                justify-content: center;
                align-items: center;
            }
            
            .pmohm-stats {
                grid-template-columns: 1fr !important;
            }
            
            .pmohm-stats > div {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 12px !important;
            }
            
            .pmohm-stats h3 {
                margin-bottom: 0 !important;
            }
            
            .pmohm-history-wrapper .habit-cell {
                height: 28px !important;
                width: 28px !important;
            }
            
            .habit-cell.completed::after {
                font-size: 18px;
            }
            
            .habit-name-input {
                font-size: 16px !important;
                white-space: normal;
                overflow: visible;
                text-overflow: clip;
                min-width: 150px;
                max-width: 100%;
                padding: 10px 4px;
                height: auto;
                line-height: 1.3;
            }
            
            /* Extra spacing voor habit rows */
            .habit-row {
                margin-bottom: 16px !important;
                border-bottom: 1px solid rgba(0,0,0,0.05);
                padding-bottom: 16px;
                display: grid;
                grid-template-columns: 5fr repeat(7, minmax(28px, 1fr)) !important;
            }
            
            /* Make dates smaller */
            .date-cell {
                font-size: 11px !important;
            }
            
            .date-header {
                font-size: 11px !important;
            }
            
            /* Verbeterde mobiele navigatie */
            .category-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .category-header h2 {
                margin-bottom: 6px;
            }
            
            /* Meer ruimte voor naam-invoerveld */
            .habit-name-cell {
                display: flex;
                flex-direction: column !important;
                align-items: flex-start !important;
                margin-bottom: 5px;
                min-height: 60px !important;
                justify-content: center;
            }
            
            .habit-name-cell .flex-grow {
                width: 100%;
                margin-bottom: 8px;
            }
            
            /* Kleinere delete-knop voor habits op mobiel */
            .habit-name-cell .fa-trash-alt {
                font-size: 16px;
                margin-top: 5px;
            }
            
            /* Grotere knoppen voor toevoegen van habits */
            .add-habit-btn {
                padding: 12px !important;
                font-size: 15px;
                font-weight: 500;
            }
            
            /* Week navigatie knoppen groter en duidelijker */
            .btn {
                padding: 8px 15px !important;
                font-size: 16px;
            }
        }
        
        /* Landscape-modus op mobiel telefoons */
        @media (max-width: 896px) and (orientation: landscape) {
            .grid-cols-8 {
                grid-template-columns: 2fr repeat(7, 1fr) !important;
            }
            
            .habit-name-input {
                max-width: 100px;
            }
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    
    <!-- Firebase configuratie -->
    <script>
      // Firebase configuratie
      const firebaseConfig = {
        apiKey: "AIzaSyCjAXyIEEyhvVAadd4v4it1bHoWhJXSmd8",
        authDomain: "striks-habit-tracker.firebaseapp.com",
        projectId: "striks-habit-tracker",
        storageBucket: "striks-habit-tracker.firebasestorage.app",
        messagingSenderId: "583114774251",
        appId: "1:583114774251:web:7df7c25e0ed0b08036d0ae",
        measurementId: "G-P02LE94672"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const auth = firebase.auth();
      
      // Login state observer
      let currentUser = null;
      
      // Wacht tot het document geladen is
      document.addEventListener('DOMContentLoaded', function() {
        // Voeg event listeners toe aan de knoppen
        document.getElementById('logout-btn').addEventListener('click', function() {
          auth.signOut().then(() => {
            window.location.href = 'login.html';
          }).catch((error) => {
            console.error("Uitlogfout:", error);
            alert("Er is een fout opgetreden bij het uitloggen. Probeer het opnieuw.");
          });
        });
        
        // Navigation event handlers
        document.getElementById('prev-week').addEventListener('click', function() {
          weekOffset--;
          updateDateRow();
        });
        
        document.getElementById('next-week').addEventListener('click', function() {
          weekOffset++;
          updateDateRow();
        });
        
        document.getElementById('current-week').addEventListener('click', function() {
          weekOffset = 0;
          updateDateRow();
        });
        
        // Add new habit functionality
        document.getElementById('add-hardline').addEventListener('click', function() {
          addNewHabit('hardline');
        });
        
        document.getElementById('add-mainline').addEventListener('click', function() {
          addNewHabit('mainline');
        });
        
        document.getElementById('add-softline').addEventListener('click', function() {
          addNewHabit('softline');
        });
      });
      
      // Controleer of gebruiker is ingelogd
      auth.onAuthStateChanged(async function(user) {
        if (!user) {
          // Niet ingelogd, terug naar login pagina
          window.location.href = 'login.html';
          return;
        }
        
        // Gebruiker is ingelogd
        currentUser = user;
        
        // Toon gebruikersnaam (e-mail of displayName indien beschikbaar)
        const displayName = user.displayName || user.email.split('@')[0];
        document.getElementById('username-display').textContent = displayName;
        
        // Laad gebruikersdata en render
        await loadUserData();
        updateDateRow();
      });
      
      // Initializing habit data structure
      const habitData = {
        hardline: [],
        mainline: [],
        softline: []
      };
      
      // PMOHM speciale habit data
      let pmohmData = {
        streaks: [],  // Array van voorgaande streaks
        currentStreak: 0,
        highestStreak: 0,
        completed: {}, // Key: YYYY-MM-DD, Value: true/false
        lastCompleted: null,
        total: 0
      };
      
      // Standaard habits - deze worden alleen gebruikt als de gebruiker nog geen data heeft
      const defaultHabits = {
        hardline: [
          { id: 'h1', name: 'Morning Meditation', completed: {} },
          { id: 'h2', name: 'Exercise 30 minutes', completed: {} },
          { id: 'h3', name: 'Read 10 pages', completed: {} },
          { id: 'h4', name: 'Drink 8 glasses of water', completed: {} },
          { id: 'h5', name: 'No screen time after 10pm', completed: {} }
        ],
        mainline: [
          { id: 'm1', name: 'Journal Writing', completed: {} },
          { id: 'm2', name: 'Learn Something New', completed: {} },
          { id: 'm3', name: 'Connect with Someone', completed: {} },
          { id: 'm4', name: 'Healthy Eating', completed: {} },
          { id: 'm5', name: 'Plan Next Day', completed: {} }
        ],
        softline: [
          { id: 's1', name: 'Mindfulness Moment', completed: {} },
          { id: 's2', name: 'Gratitude Practice', completed: {} },
          { id: 's3', name: 'Stretch Break', completed: {} },
          { id: 's4', name: 'Declutter Space', completed: {} },
          { id: 's5', name: 'Creative Expression', completed: {} }
        ]
      };
      
      // Current date and week tracking
      let currentDate = new Date();
      let weekOffset = 0;
      
      // Format date as YYYY-MM-DD
      function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }
      
      // Get dates for the current week
      function getWeekDates(offset = 0) {
        const dates = [];
        const now = new Date();
        now.setDate(now.getDate() + (offset * 7));
        const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, ...
        const diff = now.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Adjust to get Monday
        
        for (let i = 0; i < 7; i++) {
          const date = new Date(now.setDate(diff + i));
          dates.push(date);
        }
        
        return dates;
      }
      
      // Laad gebruikersdata van Firebase
      async function loadUserData() {
        try {
          if (!currentUser) return;
          
          const userDoc = await db.collection('users').doc(currentUser.uid).get();
          
          if (userDoc.exists) {
            const userData = userDoc.data();
            
            if (userData.habits) {
              // Gebruik de opgeslagen habits direct
              ['hardline', 'mainline', 'softline'].forEach(category => {
                if (userData.habits[category]) {
                  habitData[category] = userData.habits[category];
                }
              });
            } else {
              // Als er geen habits zijn, gebruik de standaard habits
              ['hardline', 'mainline', 'softline'].forEach(category => {
                habitData[category] = [...defaultHabits[category]];
              });
              await saveUserData(); // Sla standaard habits op
            }
            
            // Laad PMOHM data als die bestaat
            if (userData.pmohm) {
              pmohmData = userData.pmohm;
              
              // Zorg ervoor dat alle benodigde velden aanwezig zijn
              if (!pmohmData.streaks) pmohmData.streaks = [];
              if (!pmohmData.completed) pmohmData.completed = {};
              if (pmohmData.currentStreak === undefined) pmohmData.currentStreak = 0;
              if (pmohmData.highestStreak === undefined) pmohmData.highestStreak = 0;
              if (pmohmData.total === undefined) pmohmData.total = 0;
              
              // Bereken huidige streak
              calculatePMOHMStreak();
            }
          } else {
            // Als de gebruiker geen document heeft, maak een nieuw aan met standaard habits
            ['hardline', 'mainline', 'softline'].forEach(category => {
              habitData[category] = [...defaultHabits[category]];
            });
            await saveUserData();
          }
        } catch (error) {
          console.error("Fout bij laden van gebruikersgegevens:", error);
        }
      }
      
      // Sla gebruikersdata op in Firebase
      async function saveUserData() {
        try {
          if (!currentUser) return;
          
          await db.collection('users').doc(currentUser.uid).set({
            habits: habitData,
            pmohm: pmohmData,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
          }, { merge: true });
          
        } catch (error) {
          console.error("Fout bij opslaan van gebruikersgegevens:", error);
        }
      }
      
      // Update the date row with dates for the current week
      function updateDateRow() {
        const dateRow = document.getElementById('date-row');
        // Clear existing dates except for the first cell
        while (dateRow.children.length > 1) {
          dateRow.removeChild(dateRow.lastChild);
        }
        
        const weekDates = getWeekDates(weekOffset);
        
        // Update week label
        const firstDay = weekDates[0];
        const lastDay = weekDates[6];
        const firstMonth = firstDay.toLocaleString('default', { month: 'short' });
        const lastMonth = lastDay.toLocaleString('default', { month: 'short' });
        
        let weekLabel;
        if (firstMonth === lastMonth) {
          weekLabel = `${firstMonth} ${firstDay.getDate()} - ${lastDay.getDate()}, ${lastDay.getFullYear()}`;
        } else {
          weekLabel = `${firstMonth} ${firstDay.getDate()} - ${lastMonth} ${lastDay.getDate()}, ${lastDay.getFullYear()}`;
        }
        
        document.getElementById('current-week-label').textContent = weekLabel;
        
        // Add dates to the row
        weekDates.forEach(date => {
          const dateCell = document.createElement('div');
          dateCell.className = 'text-center font-bold date-cell';
          
          // Highlight today's date
          const today = new Date();
          if (date.toDateString() === today.toDateString() && weekOffset === 0) {
            dateCell.className += ' text-blue-600';
          }
          
          dateCell.textContent = date.getDate();
          dateRow.appendChild(dateCell);
        });
        
        // Redraw habits grid to match dates
        updateHabitsGrid();
      }
      
      // Generate the habit tracking grid
      function generateHabitRow(habit, category) {
        const habitRow = document.createElement('div');
        habitRow.className = 'grid grid-cols-8 gap-1 sm:gap-2 mb-3 habit-row';
        
        // Habit name cell
        const nameCell = document.createElement('div');
        nameCell.className = 'pr-2 flex items-center justify-between habit-name-cell';
        nameCell.style.minHeight = '50px';
        
        const nameWrapper = document.createElement('div');
        nameWrapper.className = 'flex-grow';
        
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.className = 'habit-name-input';
        nameInput.value = habit.name;
        nameInput.placeholder = 'Enter habit name';
        nameInput.dataset.id = habit.id;
        nameInput.dataset.category = category;
        nameInput.addEventListener('change', function() {
          updateHabitName(this.dataset.category, this.dataset.id, this.value);
        });
        
        nameWrapper.appendChild(nameInput);
        nameCell.appendChild(nameWrapper);
        
        // Add delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'ml-2 text-gray-400 hover:text-red-500 focus:outline-none';
        deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
        deleteBtn.dataset.id = habit.id;
        deleteBtn.dataset.category = category;
        deleteBtn.addEventListener('click', function() {
          removeHabit(this.dataset.category, this.dataset.id);
        });
        
        nameCell.appendChild(deleteBtn);
        habitRow.appendChild(nameCell);
        
        // Get current week dates
        const weekDates = getWeekDates(weekOffset);
        
        // Create cells for each day of the week
        weekDates.forEach(date => {
          const dateString = formatDate(date);
          const cell = document.createElement('div');
          cell.className = `habit-cell ${category} h-10 flex items-center justify-center`;
          cell.style.opacity = '0.3';
          
          if (habit.completed && habit.completed[dateString]) {
            cell.classList.add('completed');
            cell.style.opacity = '1';
          }
          
          cell.dataset.date = dateString;
          cell.dataset.habitId = habit.id;
          cell.dataset.category = category;
          
          cell.addEventListener('click', function() {
            toggleHabitCompletion(this.dataset.category, this.dataset.habitId, this.dataset.date);
          });
          
          habitRow.appendChild(cell);
        });
        
        return habitRow;
      }
      
      // Update the display of habit tracking grids
      function updateHabitsGrid() {
        const categories = ['hardline', 'mainline', 'softline'];
        
        categories.forEach(category => {
          const container = document.getElementById(`${category}-habits`);
          container.innerHTML = ''; // Clear existing rows
          
          habitData[category].forEach(habit => {
            const row = generateHabitRow(habit, category);
            container.appendChild(row);
          });
        });
        
        // Update PMOHM habit tracking
        updatePMOHMGrid();
        
        updateStats();
      }
      
      // Toggle habit completion status
      function toggleHabitCompletion(category, habitId, date) {
        const habit = habitData[category].find(h => h.id === habitId);
        if (!habit.completed) {
          habit.completed = {};
        }
        
        if (habit.completed[date]) {
          delete habit.completed[date];
        } else {
          habit.completed[date] = true;
        }
        
        // Opslaan naar Firebase
        saveUserData();
        
        // Update the UI
        updateHabitsGrid();
      }
      
      // Update habit name
      function updateHabitName(category, habitId, newName) {
        const habit = habitData[category].find(h => h.id === habitId);
        habit.name = newName;
        
        // Opslaan naar Firebase
        saveUserData();
      }
      
      // Function to remove a habit
      function removeHabit(category, habitId) {
        if (confirm('Weet je zeker dat je deze habit wilt verwijderen?')) {
          // Find the index of the habit to remove
          const index = habitData[category].findIndex(h => h.id === habitId);
          if (index !== -1) {
            // Remove the habit
            habitData[category].splice(index, 1);
            
            // Save to Firebase
            saveUserData();
            
            // Update UI
            updateHabitsGrid();
          }
        }
      }
      
      // Calculate and update statistics
      function updateStats() {
        const categories = ['hardline', 'mainline', 'softline'];
        const weekDates = getWeekDates(weekOffset);
        
        let totalCompleted = 0;
        let totalPossible = 0;
        
        categories.forEach(category => {
          let categoryCompleted = 0;
          let categoryPossible = habitData[category].length * 7; // 7 days
          
          habitData[category].forEach(habit => {
            weekDates.forEach(date => {
              const dateString = formatDate(date);
              if (habit.completed && habit.completed[dateString]) {
                categoryCompleted++;
                totalCompleted++;
              }
            });
          });
          
          totalPossible += categoryPossible;
          
          // Update category stats
          const percentage = categoryPossible > 0 ? Math.round((categoryCompleted / categoryPossible) * 100) : 0;
          document.getElementById(`${category}-percentage`).textContent = `${percentage}%`;
          document.getElementById(`${category}-progress`).style.width = `${percentage}%`;
          document.getElementById(`${category}-count`).textContent = `${categoryCompleted}/${categoryPossible}`;
        });
        
        // Update total stats
        const totalPercentage = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
        document.getElementById('total-percentage').textContent = `${totalPercentage}%`;
        
        // Update progress ring
        const circle = document.querySelector('.progress-ring');
        const radius = circle.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;
        circle.style.strokeDasharray = circumference;
        const offset = circumference - (totalPercentage / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        
        // Calculate streak
        calculateStreak();
      }
      
      // Calculate streak power
      function calculateStreak() {
        let currentStreak = 0;
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        
        // Check if any habits were completed today or yesterday
        const todayString = formatDate(today);
        const yesterdayString = formatDate(yesterday);
        
        let todayCompleted = false;
        let yesterdayCompleted = false;
        
        // Check if habits were completed today
        ['hardline', 'mainline', 'softline'].forEach(category => {
          habitData[category].forEach(habit => {
            if (habit.completed && habit.completed[todayString]) {
              todayCompleted = true;
            }
            if (habit.completed && habit.completed[yesterdayString]) {
              yesterdayCompleted = true;
            }
          });
        });
        
        // Start counting streak from today or yesterday
        let checkDate;
        if (todayCompleted) {
          checkDate = new Date(today);
          currentStreak = 1;
        } else if (yesterdayCompleted) {
          checkDate = new Date(yesterday);
          currentStreak = 1;
        } else {
          // No recent completions
          document.getElementById('total-streak').textContent = '0';
          return;
        }
        
        // Count backwards to find the streak
        while (true) {
          checkDate.setDate(checkDate.getDate() - 1);
          const checkDateString = formatDate(checkDate);
          
          let dayCompleted = false;
          ['hardline', 'mainline', 'softline'].forEach(category => {
            habitData[category].forEach(habit => {
              if (habit.completed && habit.completed[checkDateString]) {
                dayCompleted = true;
              }
            });
          });
          
          if (dayCompleted) {
            currentStreak++;
          } else {
            break;
          }
        }
        
        document.getElementById('total-streak').textContent = currentStreak;
      }
      
      // Add new habit functionality
      function addNewHabit(category) {
        // Generate a unique ID based on timestamp
        const newId = `${category[0]}${Date.now()}`;
        
        // Default habit name
        let defaultName = '';
        switch(category) {
          case 'hardline':
            defaultName = 'Nieuwe Hardline Habit';
            break;
          case 'mainline':
            defaultName = 'Nieuwe Mainline Habit';
            break;
          case 'softline':
            defaultName = 'Nieuwe Softline Habit';
            break;
        }
        
        // Create new habit object
        const newHabit = {
          id: newId,
          name: defaultName,
          completed: {}
        };
        
        // Add to habit data
        habitData[category].push(newHabit);
        
        // Save to Firebase
        saveUserData();
        
        // Update UI
        updateHabitsGrid();
      }
      
      // Generate PMOHM tracking grid for current week
      function updatePMOHMGrid() {
        const container = document.getElementById('pmohm-habit');
        container.innerHTML = ''; // Clear existing content
        
        // Create PMOHM row for current week
        const pmohmRow = document.createElement('div');
        pmohmRow.className = 'grid grid-cols-8 gap-1 sm:gap-2 mb-3 habit-row';
        
        // PMOHM label cell
        const labelCell = document.createElement('div');
        labelCell.className = 'pr-2 flex items-center justify-between habit-name-cell';
        labelCell.style.minHeight = '50px';
        
        const nameWrapper = document.createElement('div');
        nameWrapper.className = 'flex-grow';
        
        const nameText = document.createElement('div');
        nameText.className = 'text-lg font-bold';
        nameText.textContent = 'PMOHM';
        
        nameWrapper.appendChild(nameText);
        labelCell.appendChild(nameWrapper);
        pmohmRow.appendChild(labelCell);
        
        // Get current week dates
        const weekDates = getWeekDates(weekOffset);
        
        // Create cells for each day of the week
        weekDates.forEach(date => {
          const dateString = formatDate(date);
          const cell = document.createElement('div');
          cell.className = 'habit-cell h-12 w-12 flex items-center justify-center';
          cell.style.backgroundColor = 'var(--primary-color)';
          cell.style.opacity = '0.3';
          
          if (pmohmData.completed && pmohmData.completed[dateString]) {
            cell.classList.add('completed');
            cell.style.opacity = '1';
          }
          
          cell.dataset.date = dateString;
          
          cell.addEventListener('click', function() {
            togglePMOHMCompletion(this.dataset.date);
          });
          
          pmohmRow.appendChild(cell);
        });
        
        container.appendChild(pmohmRow);
        
        // Update PMOHM history
        updatePMOHMHistory();
        
        // Update PMOHM stats
        updatePMOHMStats();
      }
      
      // Toggle PMOHM completion
      function togglePMOHMCompletion(date) {
        if (!pmohmData.completed) {
          pmohmData.completed = {};
        }
        
        // Toggle completion
        if (pmohmData.completed[date]) {
          delete pmohmData.completed[date];
          if (pmohmData.total > 0) pmohmData.total--;
        } else {
          pmohmData.completed[date] = true;
          pmohmData.total++;
        }
        
        // Update PMOHM streak information
        calculatePMOHMStreak();
        
        // Save data
        saveUserData();
        
        // Update UI
        updatePMOHMGrid();
      }
      
      // Calculate PMOHM streak
      function calculatePMOHMStreak() {
        // Reset current streak
        pmohmData.currentStreak = 0;
        
        // Find most recent completion
        const today = new Date();
        const completedDates = Object.keys(pmohmData.completed || {}).filter(date => pmohmData.completed[date]);
        
        if (completedDates.length === 0) return;
        
        // Sort dates in descending order
        completedDates.sort((a, b) => new Date(b) - new Date(a));
        
        // Most recent completion
        const lastDate = new Date(completedDates[0]);
        pmohmData.lastCompleted = formatDate(lastDate);
        
        // Check if completed today or yesterday
        const todayString = formatDate(today);
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayString = formatDate(yesterday);
        
        // If not completed today or yesterday, streak is over
        if (completedDates[0] !== todayString && completedDates[0] !== yesterdayString) {
          // Save the last streak to history if it was significant
          if (pmohmData.currentStreak > 1) {
            pmohmData.streaks.push(pmohmData.currentStreak);
            // Keep only last 10 streaks
            if (pmohmData.streaks.length > 10) {
              pmohmData.streaks.shift();
            }
          }
          pmohmData.currentStreak = 0;
          return;
        }
        
        // Count backwards to find current streak
        let checkDate = new Date(completedDates[0]);
        pmohmData.currentStreak = 1;
        
        while (true) {
          checkDate.setDate(checkDate.getDate() - 1);
          const checkDateString = formatDate(checkDate);
          
          if (pmohmData.completed && pmohmData.completed[checkDateString]) {
            pmohmData.currentStreak++;
          } else {
            break;
          }
        }
        
        // Update highest streak if needed
        if (pmohmData.currentStreak > pmohmData.highestStreak) {
          pmohmData.highestStreak = pmohmData.currentStreak;
        }
      }
      
      // Update PMOHM stats display
      function updatePMOHMStats() {
        document.getElementById('pmohm-streak').textContent = pmohmData.currentStreak;
        document.getElementById('pmohm-highest-streak').textContent = pmohmData.highestStreak;
        document.getElementById('pmohm-total').textContent = pmohmData.total;
        
        // Calculate average of last 5 streaks
        let avg = 0;
        const streaks = [...pmohmData.streaks];
        if (pmohmData.currentStreak > 0) {
          streaks.push(pmohmData.currentStreak);
        }
        
        if (streaks.length > 0) {
          const last5 = streaks.slice(-5);
          const sum = last5.reduce((a, b) => a + b, 0);
          avg = Math.round((sum / last5.length) * 10) / 10; // Round to 1 decimal
        }
        
        document.getElementById('pmohm-avg-streak').textContent = avg;
      }
      
      // Update PMOHM history display
      function updatePMOHMHistory() {
        const historyContainer = document.getElementById('pmohm-history');
        historyContainer.innerHTML = '';
        
        // Show history for past 4 weeks
        for (let i = 1; i <= 4; i++) {
          const weekRow = document.createElement('div');
          weekRow.className = 'grid grid-cols-8 gap-1 sm:gap-2 mb-3';
          
          // Week label
          const weekLabel = document.createElement('div');
          weekLabel.className = 'pr-2 flex items-center';
          weekLabel.textContent = `Week -${i}`;
          weekRow.appendChild(weekLabel);
          
          // Get dates for this past week
          const pastDates = getWeekDates(-i);
          
          // Create cells for each day
          pastDates.forEach(date => {
            const dateString = formatDate(date);
            const cell = document.createElement('div');
            cell.className = 'habit-cell h-8 w-8 flex items-center justify-center';
            cell.style.backgroundColor = 'var(--primary-color)';
            cell.style.opacity = '0.3';
            
            if (pmohmData.completed && pmohmData.completed[dateString]) {
              cell.classList.add('completed');
              cell.style.opacity = '1';
            }
            
            cell.dataset.date = dateString;
            
            cell.addEventListener('click', function() {
              togglePMOHMCompletion(this.dataset.date);
            });
            
            weekRow.appendChild(cell);
          });
          
          historyContainer.appendChild(weekRow);
        }
      }
    </script>
</head>
<body class="p-2 sm:p-4 md:p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex md:flex-row flex-col justify-between items-center">
                <div class="text-center md:text-left logo-container">
                    <img src="Log.png" alt="Striks AI Logo" class="logo">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">Habit Tracker</h1>
                        <p class="tagline">Human Led AI Innovation</p>
                    </div>
                </div>
                <div class="streak-container p-4 text-white mt-4 md:mt-0 w-full md:w-auto">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-xl font-bold">Total Streak Power</h3>
                            <div class="text-4xl font-bold mt-1 pulse" id="total-streak">0</div>
                        </div>
                        <div class="ml-6 relative">
                            <svg width="80" height="80" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#ffffff33" stroke-width="8" />
                                <circle class="progress-ring" cx="50" cy="50" r="45" fill="none" stroke="white" stroke-width="8" 
                                        stroke-dasharray="283" stroke-dashoffset="283" transform="rotate(-90 50 50)" />
                            </svg>
                            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-2xl font-bold" id="total-percentage">0%</div>
                        </div>
                    </div>
                    <div class="flex justify-end items-center mt-2">
                        <div class="user-welcome">
                            <div class="user-icon">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <span id="username-display"></span>
                        </div>
                        <button id="logout-btn" class="logout-btn">
                            <i class="fas fa-sign-out-alt mr-1"></i> Uitloggen
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Weekly Date Navigation -->
        <div class="card p-4 mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-2">
                <h2 class="text-xl font-bold mb-2 sm:mb-0" id="current-week-label">This Week</h2>
                <div class="flex space-x-2">
                    <button id="prev-week" class="btn bg-gray-200 hover:bg-gray-300 text-gray-700 py-1 px-3 rounded">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="current-week" class="btn bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded" style="background-color: var(--primary-color);">
                        Today
                    </button>
                    <button id="next-week" class="btn bg-gray-200 hover:bg-gray-300 text-gray-700 py-1 px-3 rounded">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-8 gap-1 sm:gap-2">
                <div class="col-span-1 pr-2 font-medium text-gray-600 text-xs sm:text-sm">Gewoonte</div>
                <div class="text-center font-medium text-gray-600 text-xs sm:text-sm date-header">Mon</div>
                <div class="text-center font-medium text-gray-600 text-xs sm:text-sm date-header">Tue</div>
                <div class="text-center font-medium text-gray-600 text-xs sm:text-sm date-header">Wed</div>
                <div class="text-center font-medium text-gray-600 text-xs sm:text-sm date-header">Thu</div>
                <div class="text-center font-medium text-gray-600 text-xs sm:text-sm date-header">Fri</div>
                <div class="text-center font-medium text-gray-600 text-xs sm:text-sm date-header">Sat</div>
                <div class="text-center font-medium text-gray-600 text-xs sm:text-sm date-header">Sun</div>
            </div>
            <div class="grid grid-cols-8 gap-1 sm:gap-2 mb-2" id="date-row">
                <div class="text-right pr-2 font-medium text-gray-600 text-xs sm:text-sm">Datum</div>
                <!-- Dates will be inserted here by JavaScript -->
            </div>
        </div>
        
        <!-- Habit Tracking Sections -->
        <div class="grid grid-cols-1 gap-8">
            <!-- PMOHM Special Habit Section -->
            <div class="card p-6 border-2" style="border-color: var(--primary-color);">
                <div class="category-header bg-red-500 text-white p-3 mb-4 flex justify-between items-center" style="background: linear-gradient(135deg, var(--primary-color), var(--accent-color));">
                    <h2 class="text-xl font-bold">PMOHM Habit Tracker</h2>
                    <div class="flex items-center">
                        <span class="mr-2">Current Streak:</span>
                        <span class="streak-badge" id="pmohm-streak">0</span>
                    </div>
                </div>
                
                <div class="pmohm-stats grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="bg-gray-100 p-3 rounded-lg">
                        <h3 class="text-md font-semibold mb-1" style="color: var(--primary-color);">Hoogste Streak</h3>
                        <div class="text-2xl font-bold" id="pmohm-highest-streak">0</div>
                    </div>
                    <div class="bg-gray-100 p-3 rounded-lg">
                        <h3 class="text-md font-semibold mb-1" style="color: var(--primary-color);">Gem. Laatste 5</h3>
                        <div class="text-2xl font-bold" id="pmohm-avg-streak">0</div>
                    </div>
                    <div class="bg-gray-100 p-3 rounded-lg">
                        <h3 class="text-md font-semibold mb-1" style="color: var(--primary-color);">Totaal Voltooid</h3>
                        <div class="text-2xl font-bold" id="pmohm-total">0</div>
                    </div>
                </div>
                
                <div class="pmohm-habit" id="pmohm-habit">
                    <!-- PMOHM tracking will be inserted here -->
                </div>
                
                <div class="pmohm-history mt-4">
                    <h3 class="text-lg font-bold mb-2">Geschiedenis (laatste 4 weken)</h3>
                    <div class="overflow-x-auto">
                        <div class="pmohm-history-wrapper" id="pmohm-history">
                            <!-- PMOHM history will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Hardline Habits Section -->
            <div class="card p-6">
                <div class="category-header bg-red-500 text-white p-3 mb-4 flex justify-between items-center" style="background-color: var(--hardline-color);">
                    <h2 class="text-xl font-bold">Hardline Habits</h2>
                    <div class="flex items-center">
                        <span class="mr-2">Completion:</span>
                        <span class="streak-badge" id="hardline-percentage">0%</span>
                    </div>
                </div>
                <div class="hardline-habits" id="hardline-habits">
                    <!-- Hardline habits will be inserted here by JavaScript -->
                </div>
                <button id="add-hardline" class="mt-3 p-2 bg-red-100 hover:bg-red-200 text-red-700 rounded flex items-center add-habit-btn" style="background-color: rgba(242, 112, 82, 0.15); color: var(--hardline-color);">
                    <i class="fas fa-plus mr-2"></i> Nieuwe hardline habit toevoegen
                </button>
            </div>
            
            <!-- Mainline Habits Section -->
            <div class="card p-6">
                <div class="category-header bg-blue-500 text-white p-3 mb-4 flex justify-between items-center" style="background-color: var(--mainline-color);">
                    <h2 class="text-xl font-bold">Mainline Habits</h2>
                    <div class="flex items-center">
                        <span class="mr-2">Completion:</span>
                        <span class="streak-badge" id="mainline-percentage">0%</span>
                    </div>
                </div>
                <div class="mainline-habits" id="mainline-habits">
                    <!-- Mainline habits will be inserted here by JavaScript -->
                </div>
                <button id="add-mainline" class="mt-3 p-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded flex items-center add-habit-btn" style="background-color: rgba(75, 153, 210, 0.15); color: var(--mainline-color);">
                    <i class="fas fa-plus mr-2"></i> Nieuwe mainline habit toevoegen
                </button>
            </div>
            
            <!-- Softline Habits Section -->
            <div class="card p-6">
                <div class="category-header bg-green-500 text-white p-3 mb-4 flex justify-between items-center" style="background-color: var(--softline-color);">
                    <h2 class="text-xl font-bold">Softline Habits</h2>
                    <div class="flex items-center">
                        <span class="mr-2">Completion:</span>
                        <span class="streak-badge" id="softline-percentage">0%</span>
                    </div>
                </div>
                <div class="softline-habits" id="softline-habits">
                    <!-- Softline habits will be inserted here by JavaScript -->
                </div>
                <button id="add-softline" class="mt-3 p-2 bg-green-100 hover:bg-green-200 text-green-700 rounded flex items-center add-habit-btn" style="background-color: rgba(138, 78, 133, 0.15); color: var(--softline-color);">
                    <i class="fas fa-plus mr-2"></i> Nieuwe softline habit toevoegen
                </button>
            </div>
        </div>
        
        <!-- Summary Section -->
        <div class="card p-6 mt-8">
            <h2 class="text-2xl font-bold mb-4">Weekly Summary</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-100 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-red-500 mb-2" style="color: var(--hardline-color);">Hardline Progress</h3>
                    <div class="flex items-center">
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-red-500 h-2.5 rounded-full" id="hardline-progress" style="width: 0%; background-color: var(--hardline-color);"></div>
                        </div>
                        <span class="ml-2 text-lg font-bold" id="hardline-count">0/0</span>
                    </div>
                </div>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-500 mb-2" style="color: var(--mainline-color);">Mainline Progress</h3>
                    <div class="flex items-center">
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-blue-500 h-2.5 rounded-full" id="mainline-progress" style="width: 0%; background-color: var(--mainline-color);"></div>
                        </div>
                        <span class="ml-2 text-lg font-bold" id="mainline-count">0/0</span>
                    </div>
                </div>
                <div class="bg-gray-100 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-green-500 mb-2" style="color: var(--softline-color);">Softline Progress</h3>
                    <div class="flex items-center">
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-green-500 h-2.5 rounded-full" id="softline-progress" style="width: 0%; background-color: var(--softline-color);"></div>
                        </div>
                        <span class="ml-2 text-lg font-bold" id="softline-count">0/0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-10 text-center text-gray-500 text-sm">
            <p>Striks AI Consulting Â© 2025 - Human Led AI Innovation</p>
            <div class="mt-2 flex justify-center items-center">
                <a href="#" class="mx-2 text-gray-400 hover:text-gray-600 transition-colors duration-300">
                    <i class="fab fa-linkedin"></i>
                </a>
                <a href="#" class="mx-2 text-gray-400 hover:text-gray-600 transition-colors duration-300">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="mx-2 text-gray-400 hover:text-gray-600 transition-colors duration-300">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
        </footer>
    </div>
</body>
</html> 